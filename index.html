<!-- Full HTML including JavaScript already added above; additional scripts will now follow -->
<script>
let siswa = JSON.parse(localStorage.getItem("dataSiswa") || "[]");
let currentPassword = localStorage.getItem("guruPass") || "admin";

function login() {
  const u = document.getElementById("username").value;
  const p = document.getElementById("password").value;
  if (u === "guru" && p === currentPassword) {
    document.getElementById("login-box").style.display = "none";
    document.getElementById("main-content").style.display = "block";
    renderTabel();
  } else {
    alert("Login gagal!");
  }
}

function logout() {
  document.getElementById("main-content").style.display = "none";
  document.getElementById("login-box").style.display = "block";
}

function simpan() {
  localStorage.setItem("dataSiswa", JSON.stringify(siswa));
  alert("Data tersimpan.");
}

function tambahSiswa() {
  const nama = document.getElementById("namaInput").value;
  const kelas = document.getElementById("kelasInput").value;
  const bulan = document.getElementById("bulanInput").value;
  if (!nama || !kelas || !bulan) return alert("Isi semua kolom!");
  siswa.push({ nama, kelas, bulan, kehadiran: "Hadir", harian: "", formatif1: "", formatif2: "", formatif3: "", formatif4: "", formatif5: "", sts: "", sas: "", catatan: "" });
  document.getElementById("namaInput").value = "";
  renderTabel();
}

function hitungRata(s) {
  const f = [s.formatif1, s.formatif2, s.formatif3, s.formatif4, s.formatif5].map(n => parseFloat(n) || 0);
  return (f.reduce((a,b) => a+b, 0)/5).toFixed(1);
}

function renderTabel() {
  const tbody = document.getElementById("tabel-siswa");
  tbody.innerHTML = "";
  const filterKelas = document.getElementById("filterKelas").value;
  const filterBulan = document.getElementById("filterBulan").value;
  let kelasSet = new Set(), bulanSet = new Set();

  siswa.forEach((s, i) => {
    kelasSet.add(s.kelas);
    bulanSet.add(s.bulan);
    if ((filterKelas && s.kelas !== filterKelas) || (filterBulan && s.bulan !== filterBulan)) return;

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${i+1}</td>
      <td contenteditable oninput="siswa[${i}].nama=this.innerText">${s.nama}</td>
      <td contenteditable oninput="siswa[${i}].kelas=this.innerText">${s.kelas}</td>
      <td>${s.bulan}</td>
      <td>
        <select onchange="siswa[${i}].kehadiran=this.value">${["Hadir","Izin","Sakit","Alpa"].map(opt => `<option ${s.kehadiran===opt?'selected':''}>${opt}</option>`)}</select>
      </td>
      <td><input type="number" value="${s.harian}" onchange="siswa[${i}].harian=this.value"></td>
      <td><input type="number" value="${s.formatif1}" onchange="siswa[${i}].formatif1=this.value"></td>
      <td><input type="number" value="${s.formatif2}" onchange="siswa[${i}].formatif2=this.value"></td>
      <td><input type="number" value="${s.formatif3}" onchange="siswa[${i}].formatif3=this.value"></td>
      <td><input type="number" value="${s.formatif4}" onchange="siswa[${i}].formatif4=this.value"></td>
      <td><input type="number" value="${s.formatif5}" onchange="siswa[${i}].formatif5=this.value"></td>
      <td>${hitungRata(s)}</td>
      <td><input type="number" value="${s.sts}" onchange="siswa[${i}].sts=this.value"></td>
      <td><input type="number" value="${s.sas}" onchange="siswa[${i}].sas=this.value"></td>
      <td><input type="text" value="${s.catatan}" onchange="siswa[${i}].catatan=this.value"></td>
      <td><button class="btn btn-danger" onclick="hapus(${i})">Hapus</button></td>
    `;
    tbody.appendChild(tr);
  });

  const filterKelasSel = document.getElementById("filterKelas");
  filterKelasSel.innerHTML = "<option value=''>Semua</option>" + [...kelasSet].map(k => `<option ${filterKelas===k?'selected':''}>${k}</option>`).join("");
  document.getElementById("filterBulan").innerHTML = "<option value=''>Semua</option>" + [...bulanSet].map(b => `<option ${filterBulan===b?'selected':''}>${b}</option>`).join("");

  renderRekap();
}

function hapus(i) {
  if (confirm("Hapus data ini?")) {
    siswa.splice(i, 1);
    renderTabel();
  }
}

function gantiPassword() {
  const baru = prompt("Masukkan password baru:");
  if (baru) {
    localStorage.setItem("guruPass", baru);
    currentPassword = baru;
    alert("Password diperbarui.");
  }
}

function renderRekap() {
  const bulan = document.getElementById("filterBulan").value;
  const rekapBox = document.getElementById("rekapBox");
  if (!bulan) return rekapBox.innerHTML = "";
  const total = siswa.filter(s => s.bulan === bulan);
  const hadir = total.filter(s => s.kehadiran === "Hadir").length;
  const izin = total.filter(s => s.kehadiran === "Izin").length;
  const sakit = total.filter(s => s.kehadiran === "Sakit").length;
  const alpa = total.filter(s => s.kehadiran === "Alpa").length;
  rekapBox.innerHTML = `
    <h3>Rekap Bulan ${bulan}</h3>
    <p>Jumlah data: ${total.length}</p>
    <p>Hadir: ${hadir}, Izin: ${izin}, Sakit: ${sakit}, Alpa: ${alpa}</p>
  `;
}

// Auto show login
window.onload = () => {
  document.getElementById("login-box").style.display = "block";
};
</script>
